!function(t){var e={events:[],detailedViewBreakpoint:550,onEventClick:null,onPreviousMonthStart:null,onNextMonthStart:null,onCurrentMonthStart:null,onLoadStart:null,onLoadEnd:null},n={start:null,end:null,title:"",url:"","class":"",data:{}},a={init:function(a){return this.each(function(){var s=t(this),o=s.data("equinox");if(!o){for(var d=t.extend({},e,a),i=moment(),v=[],u=0;u<d.events.length;u++)d.events[u]=t.extend({},n,d.events[u]),d.events[u].start=moment(d.events[u].start),d.events[u].end=moment(d.events[u].end),d.events[u].start.isValid()&&d.events[u].end.isValid()&&(d.events[u].start.valueOf()>d.events[u].end.valueOf()||(d.events[u].allDay=r(d.events[u].start,d.events[u].end),d.events[u].daySpan=l(d.events[u].start,d.events[u].end),v.push(d.events[u])));d.events.sort(function(t,e){return t.start.valueOf()-e.start.valueOf()});for(var c=[],u=0;u<d.events.length;u++){d.events[u].id=u;var f=moment(d.events[u].start).startOf("day").format("UX");f in c||(c[f]=[]),c[f].push(d.events[u])}o={target:s,settings:d,currentDate:i,segmentedEvents:c,activeMonth:moment(i).startOf("month")},s.data("equinox",o),s.addClass("equinox"),s.equinox("refresh"),s.equinox("load"),t(window).resize(function(){s.equinox("refresh")}),s.on("click",".calendar-actions button.prev",function(t){var e=s.data("equinox");e.activeMonth.subtract(1,"months"),typeof e.settings.onPreviousMonthStart==typeof Function&&e.settings.onPreviousMonthStart(t,e),s.equinox("load")}),s.on("click",".calendar-actions button.next",function(t){var e=s.data("equinox");e.activeMonth.add(1,"months"),typeof e.settings.onNextMonthStart==typeof Function&&e.settings.onNextMonthStart(t,e),s.equinox("load")}),s.on("click",".calendar-actions button.today",function(t){var e=s.data("equinox"),n=moment().startOf("month");typeof e.settings.onCurrentMonthStart==typeof Function&&e.settings.onCurrentMonthStart(t,e),0!==e.activeMonth.startOf("month").diff(n)&&(e.activeMonth=n,s.equinox("load"))}),s.on("click","a.event",function(e){var n=s.data("equinox");if(typeof n.settings.onEventClick==typeof Function){var a=n.settings.events[t(this).data("event-id")],o=t.extend({start:a.start,end:a.end,title:a.title,url:a.url,"class":a.class},a.data);n.settings.onEventClick(e,o)}})}})},load:function(){return this.each(function(){var e=t(this),n=e.data("equinox");typeof n.settings.onLoadStart==typeof Function&&n.settings.onLoadStart(n);var a=n.activeMonth,o=s(a,n.segmentedEvents);typeof n.settings.onLoadEnd==typeof Function&&n.settings.onLoadEnd(n),e.html(o)})},refresh:function(){return this.each(function(){var e=t(this),n=e.data("equinox");e.width()<n.settings.detailedViewBreakpoint?e.removeClass("detailed"):e.addClass("detailed")})}};t.fn.equinox=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.equinox"):a.init.apply(this,arguments)};var s=function(e,n){var a=t('<div class="calendar"></div>'),s=t('<div class="calendar-header"></div>');s.append('<div class="month-label">'+e.format("MMMM YYYY")+"</div>"),s.append('<div class="calendar-actions"></div>'),t(".calendar-actions",s).append('<button type="button" class="prev">Previous</button> '),t(".calendar-actions",s).append('<button type="button" class="next">Next</button> '),t(".calendar-actions",s).append('<button type="button" class="today">Today</button> '),a.append(s);for(var r=t('<div class="month-weeks"></div>'),v=t('<div class="week week-header"><div class="days-container"></div></div>'),u=0;7>u;u++){var c='<span class="simple-label">'+moment().day(u).format("dd").substr(0,1)+"</span>",f='<span class="detailed-label">'+moment().day(u).format("dddd")+"</span>";t(".days-container",v).append('<div class="day '+moment().day(u).format("dddd").toLowerCase()+'">'+c+f+"</div>")}r.append(v);var p=moment(e).startOf("month").startOf("week"),m=[];for(var u in n){if(parseInt(u.substr(1))>=p.unix())break;for(var h=0;h<n[u].length;h++)n[u][h].end.valueOf()>p.valueOf()&&(n[u][h].daysLeft=l(p,n[u][h].end)-(i(n[u][h].end)?1:0),m.push(n[u][h]))}var y=!1,g=e.daysInMonth(),x=moment();for(u=0;!y;u++){for(var M=t('<div class="week week-'+u+'"></div>'),b=[[]],S=moment(p),h=0;7>h;h++){if(S.day(h),0===h)for(var k=0;k<m.length;k++){for(var L=0;b[L][h];)L++,L in b||(b[L]=[]);b[L][h]=m[k];for(var O=h+1;O<m[k].daysLeft+h&&7>O;O++)b[L][O]="reserved"}for(var q=(S.format("UX")in n?n[S.format("UX")]:[]),k=0;k<q.length;k++)if(!(q[k].daySpan<2)){for(var L=0;b[L][h];)L++,L in b||(b[L]=[]);q[k].daysLeft=q[k].daySpan-(i(q[k].end)?1:0),b[L][h]=q[k];for(var O=h+1;O<q[k].daysLeft+h&&7>O;O++)b[L][O]="reserved"}}m=[],M.append('<ul class="week-events"></ul>');for(var h=0;h<b.length;h++){for(var L=t('<li class="slot"><ul></ul></li>'),k=0;7>k;k++)if("reserved"!==b[h][k])if(b[h][k]){var w=t('<li class="event-container span-'+Math.min(b[h][k].daysLeft,7-k)+'"></li>');b[h][k].daySpan-(i(b[h][k].end)?1:0)>b[h][k].daysLeft&&w.addClass("continuation"),b[h][k].daysLeft>7-k&&w.addClass("continued"),w.append(d(b[h][k])),t("ul",L).append(w),b[h][k].daysLeft>7-k?(b[h][k].daysLeft-=7-k,m.push(b[h][k])):delete b[h][k].daysLeft}else t("ul",L).append('<li class="event-container"></li>');t(".week-events",M).append(L)}M.append('<div class="days-container"></div>');for(var h=0;7>h;h++){p.day(h);for(var C=[],k=0;k<b.length;k++)b[k][h]&&C.push(k);var q=p.format("UX")in n?n[p.format("UX")]:[];t(".days-container",M).append(o(p,q,C,e,x)),p.month()===e.month()&&p.date()===g&&(y=!0)}r.append(M),p.add("days",1)}return a.append(r),a},o=function(e,n,a,s,o){var r=["date","date-"+e.date(),"day",moment(e).format("dddd").toLowerCase()];e.month()!==s.month()&&r.push("outside-month"),moment(e).startOf("day").valueOf()===moment(o).startOf("day").valueOf()&&r.push("current-date");var i=t('<div class="'+r.join(" ")+'"></div>');i.append('<div class="date-label">'+e.date()+"</div>"),(1===e.date()||e.month()!==s.month()&&0===e.day())&&t(".date-label",i).prepend('<span class="date-month-label">'+e.format("MMM")+"</span> "),i.append('<ul class="date-events"></ul>');for(var l=0,v=a.shift(),u=0;u<n.length;u++){if(l===v)t(".date-events",i).append('<li class="event-container placeholder"></li>'),v=a.shift(),u--;else{if(n[u].daySpan>2)continue;var c=t('<li class="event-container"></li>');c.append(d(n[u])),t(".date-events",i).append(c)}l++}return i},d=function(e){var n=t('<a class="event '+e.class+'" href="'+e.url+'"></a>');return n.data("event-id",e.id),n.append('<span class="start-time">'+e.start.format(0===e.start.minutes()?"ha":"h:mma")+"</span>"),n.append('<span class="title">'+e.title+"</span>"),n},r=function(t,e){return e.diff(t)%moment.duration(1,"days").asMilliseconds()===0},i=function(t){return"00:00:00.000"===t.format("HH:mm:ss.SSS")},l=function(t,e){var n=moment(t).startOf("day"),a=moment(e).startOf("day");return a.diff(n)/moment.duration(1,"days").asMilliseconds()+1}}(jQuery);