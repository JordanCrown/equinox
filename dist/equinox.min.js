!function($){var t={events:[],detailedWidthBreakpoint:550,onEventClick:null,onPreviousMonthStart:null,onNextMonthStart:null,onCurrentMonthStart:null,onLoadStart:null,onLoadEnd:null},e={start:null,end:null,title:"",url:"","class":"",data:{}},n={init:function(n){return this.each(function(){var a=$(this),s=a.data("equinox");if(!s){for(var o=$.extend({},t,n),r=moment(),l=[],v=0;v<o.events.length;v++)o.events[v]=$.extend({},e,o.events[v]),o.events[v].start=moment(o.events[v].start),o.events[v].end=moment(o.events[v].end),o.events[v].start.isValid()&&o.events[v].end.isValid()&&(o.events[v].start.valueOf()>o.events[v].end.valueOf()||(o.events[v].allDay=d(o.events[v].start,o.events[v].end),o.events[v].daySpan=i(o.events[v].start,o.events[v].end),l.push(o.events[v])));o.events.sort(function(t,e){return t.start.valueOf()-e.start.valueOf()});for(var u=[],v=0;v<o.events.length;v++){o.events[v].id=v;var f=moment(o.events[v].start).startOf("day").format("UX");f in u||(u[f]=[]),u[f].push(o.events[v])}s={target:a,settings:o,currentDate:r,segmentedEvents:u,activeMonth:moment(r).startOf("month")},a.data("equinox",s),a.addClass("equinox"),a.equinox("refresh"),a.equinox("load"),$(window).resize(function(){a.equinox("refresh")}),a.on("click",".calendar-actions button.prev",function(t){var e=a.data("equinox");e.activeMonth.subtract(1,"months"),typeof e.settings.onPreviousMonthStart==typeof Function&&e.settings.onPreviousMonthStart(t,e),a.equinox("load")}),a.on("click",".calendar-actions button.next",function(t){var e=a.data("equinox");e.activeMonth.add(1,"months"),typeof e.settings.onNextMonthStart==typeof Function&&e.settings.onNextMonthStart(t,e),a.equinox("load")}),a.on("click",".calendar-actions button.today",function(t){var e=a.data("equinox"),n=moment().startOf("month");typeof e.settings.onCurrentMonthStart==typeof Function&&e.settings.onCurrentMonthStart(t,e),0!==e.activeMonth.startOf("month").diff(n)&&(e.activeMonth=n,a.equinox("load"))}),a.on("click","a.event",function(t){var e=a.data("equinox");if(typeof e.settings.onEventClick==typeof Function){var n=e.settings.events[$(this).data("event-id")],s=$.extend({start:n.start,end:n.end,title:n.title,url:n.url,"class":n.class},n.data);e.settings.onEventClick(t,s)}})}})},load:function(){return this.each(function(){var t=$(this),e=t.data("equinox");typeof e.settings.onLoadStart==typeof Function&&e.settings.onLoadStart(e);var n=e.activeMonth,s=a(n,e.segmentedEvents);typeof e.settings.onLoadEnd==typeof Function&&e.settings.onLoadEnd(e),t.html(s)})},refresh:function(){return this.each(function(){var t=$(this),e=t.data("equinox");t.width()<e.settings.detailedWidthBreakpoint?t.removeClass("detailed"):t.addClass("detailed")})}};$.fn.equinox=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void $.error("Method "+t+" does not exist on jQuery.equinox"):n.init.apply(this,arguments)};var a=function(t,e){var n=$('<div class="calendar"></div>'),a=$('<div class="calendar-header"></div>');a.append('<div class="month-label">'+t.format("MMMM YYYY")+"</div>"),a.append('<div class="calendar-actions"></div>'),$(".calendar-actions",a).append('<button type="button" class="prev">Previous</button> '),$(".calendar-actions",a).append('<button type="button" class="next">Next</button> '),$(".calendar-actions",a).append('<button type="button" class="today">Today</button> '),n.append(a);for(var d=$('<div class="month-weeks"></div>'),l=$('<div class="week week-header"><div class="days-container"></div></div>'),v=0;7>v;v++)$(".days-container",l).append('<div class="day '+moment().day(v).format("dddd").toLowerCase()+'">'+moment().day(v).format("dddd")+"</div>");d.append(l);var u=moment(t).startOf("month").startOf("week"),f=[];for(var v in e){if(parseInt(v.substr(1))>=u.unix())break;for(var c=0;c<e[v].length;c++)e[v][c].end.valueOf()>u.valueOf()&&(e[v][c].daysLeft=i(u,e[v][c].end)-(r(e[v][c].end)?1:0),f.push(e[v][c]))}var p=!1,h=t.daysInMonth(),m=moment();for(v=0;!p;v++){for(var y=$('<div class="week week-'+v+'"></div>'),g=[[]],x=moment(u),c=0;7>c;c++){if(x.day(c),0===c)for(var M=0;M<f.length;M++){for(var S=0;g[S][c];)S++,S in g||(g[S]=[]);g[S][c]=f[M];for(var b=c+1;b<f[M].daysLeft+c&&7>b;b++)g[S][b]="reserved"}for(var k=(x.format("UX")in e?e[x.format("UX")]:[]),M=0;M<k.length;M++)if(!(k[M].daySpan<2)){for(var S=0;g[S][c];)S++,S in g||(g[S]=[]);k[M].daysLeft=k[M].daySpan-(r(k[M].end)?1:0),g[S][c]=k[M];for(var b=c+1;b<k[M].daysLeft+c&&7>b;b++)g[S][b]="reserved"}}f=[],y.append('<ul class="week-events"></ul>');for(var c=0;c<g.length;c++){for(var S=$('<li class="slot"><ul></ul></li>'),M=0;7>M;M++)if("reserved"!==g[c][M])if(g[c][M]){var L=$('<li class="event-container span-'+Math.min(g[c][M].daysLeft,7-M)+'"></li>');g[c][M].daySpan-(r(g[c][M].end)?1:0)>g[c][M].daysLeft&&L.addClass("continuation"),g[c][M].daysLeft>7-M&&L.addClass("continued"),L.append(o(g[c][M])),$("ul",S).append(L),g[c][M].daysLeft>7-M?(g[c][M].daysLeft-=7-M,f.push(g[c][M])):delete g[c][M].daysLeft}else $("ul",S).append('<li class="event-container"></li>');$(".week-events",y).append(S)}y.append('<div class="days-container"></div>');for(var c=0;7>c;c++){u.day(c);for(var O=[],M=0;M<g.length;M++)g[M][c]&&O.push(M);var k=u.format("UX")in e?e[u.format("UX")]:[];$(".days-container",y).append(s(u,k,O,t,m)),u.month()===t.month()&&u.date()===h&&(p=!0)}d.append(y),u.add("days",1)}return n.append(d),n},s=function(t,e,n,a,s){var d=["date","date-"+t.date(),"day",moment(t).format("dddd").toLowerCase()];t.month()!==a.month()&&d.push("outside-month"),moment(t).startOf("day").valueOf()===moment(s).startOf("day").valueOf()&&d.push("current-date"),(e.length||n.length)&&d.push("has-events");var r=$('<div class="'+d.join(" ")+'"></div>');r.append('<div class="date-label">'+(1===t.date()?t.format("MMM "):"")+t.date()+"</div>"),r.append('<ul class="date-events"></ul>');for(var i=0,l=n.shift(),v=0;v<e.length;v++){if(i===l)$(".date-events",r).append('<li class="event-container placeholder"></li>'),l=n.shift(),v--;else{if(e[v].daySpan>=2)continue;var u=$('<li class="event-container"></li>');u.append(o(e[v])),$(".date-events",r).append(u)}i++}return r},o=function(t){var e=$('<a class="event '+t.class+'" href="'+t.url+'"></a>');return e.data("event-id",t.id),e.append('<span class="start-time">'+t.start.format(0===t.start.minutes()?"ha":"h:mma")+"</span>"),e.append('<span class="title">'+t.title+"</span>"),e},d=function(t,e){return e.diff(t)%moment.duration(1,"days").asMilliseconds()===0},r=function(t){return"00:00:00.000"===t.format("HH:mm:ss.SSS")},i=function(t,e){var n=moment(t).startOf("day"),a=moment(e).startOf("day");return a.diff(n)/moment.duration(1,"days").asMilliseconds()+1}}(jQuery);